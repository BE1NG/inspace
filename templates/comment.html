{% extends 'base.html' %}

{% block content %}
<div class="container">
    <form id="commentForm" name="commentForm" method="post">
        {% csrf_token %}
        <div>
            <div>
                <span><strong>Comments</strong></span> <span id="cCnt"></span>
            </div>
            <div class="block">
                <p>게시자 : {{ posting.email.email }}</p>
                <p>위치 : {{ posting.location }}</p>
                <a href="/inspace/comment/">
                <img src="/static/profile_image/{{ posting.picture }}" width="540px" height="620px">
                </a>
                <p class="con">{{ posting.content }}</p>
                <p class="comments">
                    <a href="/inspace/comment/">
                    댓글
                    </a>
                </p>
            </div>
            <div>
                <table class="table">
                    <tr>
                        <td>
                            <textarea style="width: 100%" rows="3" cols="30" id="comment" name="comment"
                                placeholder="댓글 입력"></textarea>
                            <br>
                            <div>
                                <button type="submit" class="btn btn-default">등록</button>
                            </div>
                    <tr>
                        <th>Comments
                            <hr>
                        </th>
                    </tr>
                    <tr>
                        <tbody>
                            {% for User_Comment in User_Comment_list %}
                            <tr>
                                <td>
                                    <span>{{ User_Comment.email }}</span>
                                    <span>{{ User_Comment.comment }}</span>
                                    <span style="float: right">
                                        <input type="button" class="btn btn-default" value="수정" onclick='modify(this)' c-id="{{ User_Comment.id }}">
                                        <!-- <input type="button" class="btn btn-default" value="삭제" onclick='modify(this)' d-id="{{ User_Comment.id }}"> -->
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </tr>
                    </td>
                    </tr>
                </table>
            </div>
        </div>
        <input type="hidden" id="id" name="id" value="{{ param.id }}" />
    </form>
</div>
<div class="container">
    <form id="commentListForm" name="commentListForm" method="post">
        <div id="commentList">
        </div>
    </form>
</div>

<script>
    function modify(obj) {
        var e = $(obj).parent().prev();
        if(!e.children().is('input')) {
            var comment = e.text();
            var html = `<input type='text' value='${comment}'>`;
            e.html(html);
        } else {
            var comment = e.find('input').val();
            var id = $(obj).attr('c-id');
            // ajax 댓글 수정 요청
            $.ajax({
                url: `/inspace/comment/${id}/`,
                data: {comment: comment},
                success: function(res) {
                    alert(res.msg);
                    e.text(comment);
                }
            });
        }
    }
</script>


{% endblock %}